{% extends 'shopMitra/basic.html' %} {% block title %} shopMitra-CheckOut {% endblock %} 

{% block content %}

<div class="container my-5">
  <div class="col my-4">
    <h3 class="text-center">
      Step 1 - shopMitra Express Checkout - Review Your Cart Items
    </h3>
    <div class='my-4'>
      <ul class="list-group list-group-numbered" id="items">
      </ul>
      <nav aria-label="breadcrumb" class="mt-2">
        <ol class="breadcrumb justify-content-center">
          <li class="breadcrumb-item active" aria-current="page">Your Cart Total is <b>Rs.<span id="totalprice"></span></b> Enter Your Details Below And Place Your orders. Thank You For Choosing shopMitra!</li>
        </ol>
      </nav>
    </div>
  </div>
  <div class="col my-4">
    <h3 class="text-center">step 2 - Enter Address & Payment Details:</h3>
    <form id="checkoutform" class="row g-3" method="post" action="{% url 'Checkout' %}">{% csrf_token %}
      <input type="hidden" id="itemsjson" name="itemsjson">
      <div class="col-md-6">
        <label for="name" class="form-label">Name</label>
        <input  
          type="text"
          class="form-control"
          id="name"
          name = "name"
          placeholder="Name"
          required
        />
      </div>
      <div class="col-md-6">
        <label for="email" class="form-label">Email</label>
        <input
          type="email"
          class="form-control"
          id="email"
          name="email"
          placeholder="Email"
          required
        />
      </div>
      <div class="col-12">
        <label for="address1" class="form-label">Address</label>
        <input
          type="text"
          class="form-control"
          id="address1"
          name="address1"
          placeholder="1234 Main St"
          required
        />
      </div>
      <div class="col-12">
        <label for="address2" class="form-label">Address Line 2</label>
        <input
          type="text"
          class="form-control"
          id="address2"
          name="address2"
          placeholder="Apartment, studio, or floor"
        />
      </div>
      <div class="col-md-6">
        <label for="city" class="form-label">City</label>
        <input type="text" class="form-control" id="city" name="city" required />
      </div>
      <div class="col-md-4">
        <label for="state" class="form-label">State</label>
        <input
          type="text"
          class="form-control"
          id="state"  
          name="state"
          placeholder="Enter State"
          required
        />
      </div>
      <div class="col-md-2">
        <label for="zip" class="form-label">Zip</label>
        <input type="text" class="form-control" id="zip" name="zip" />
      </div>
      <div class="col-md-2">
        <label for="phone" class="form-label">Phone Number</label>
        <input
          type="tel"
          class="form-control"
          id="phone"
          name="phone"
          placeholder="Phone Number"
          required
        />
      </div>
      <label>
      <input type="radio" name="payment_method" value="COD" checked>
          Cash On Delivery
      </label>
      <label>
      <input type="radio" name="payment_method" value="ONLINE">
          Online Payment
      </label>

      <div class="col-12">
        <button type="submit" class="btn btn-success">
            Place Order
        </button>
      </div>
    </form>
  </div>
</div>

{% endblock %} 
{% block js %}
{{ block.super }}
<script>
  if (localStorage.getItem("cart") == null) {
    var cart = {};
  } else {
    cart = JSON.parse(localStorage.getItem("cart"));
  }
  console.log(cart);
  var sum = 0;
  var totalprice = 0;
  if ($.isEmptyObject(cart))
  {
      mystr = `<li class="list-group-item d-flex justify-content-center align-items-start list-group-item-danger">
                  <p>Your Cart is Empty, Please Add Items to your Cart To Checkout.</p>
               </li>`
      $("#items").append(mystr);
  }
  else
  {
    for (item in cart) {
      let name = cart[item][1];
      let qty = cart[item][0];
      let itemprice = cart[item][2];
      sum = sum + qty;
      totalprice = totalprice + qty * itemprice
      mystr = `<li class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="ms-2 me-auto">
                    <div class="fw-bold">${name}</div>
                  </div>
                  <span class="badge text-bg-primary rounded-pill">${qty}</span>
               </li>`
      $("#items").append(mystr);
    }
  }
  document.getElementById('cart').innerHTML = sum;
  document.getElementById('totalprice').innerHTML = totalprice;
  $('#itemsjson').val(JSON.stringify(cart));
  {% if thank %}
    alert("Thank you for ordering from shopMitra. Your order has been placed successfully. your order id is {{ id }}.Use it to track your order.");
    localStorage.clear();
    localStorage.removeItem("orderSubmitted");
    document.location="/";
  {% endif %}
</script>

{% endblock %}
